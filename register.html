<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>–ñ—É—Ä–Ω–∞–ª –ø–∞–ª–∏–≤–Ω–∏—Ö —Ç–∞–ª–æ–Ω—ñ–≤</title>

<style>
body{
  font-family:system-ui,Arial,sans-serif;
  background:#f4f6f8;
  margin:0;
  padding:20px;
}
.container{
  max-width:1200px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:10px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}
.header{
  text-align:center;
  padding-bottom:12px;
  border-bottom:1px solid #e0e0e0;
  margin-bottom:20px;
}
.logo{max-width:100px;margin-bottom:8px}
h1{font-size:20px;margin:0}
h2{color:#2f6fad}
.controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:10px;
}
input,select,textarea{
  padding:10px;
  font-size:15px;
}
button{
  padding:10px 14px;
  cursor:pointer;
}
button.primary{
  background:#2f6fad;
  color:#fff;
  border:none;
}
button.secondary{
  background:#9aa5b1;
  color:#fff;
  border:none;
}
button.danger{
  background:#e74c3c;
  color:#fff;
  border:none;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
  font-size:14px;
}
th,td{
  border:1px solid #ddd;
  padding:8px;
  text-align:center;
}
th{background:#f0f3f7}
.used{background:#e9f7ef}
.summary{
  margin-top:20px;
  display:flex;
  gap:30px;
  flex-wrap:wrap;
  font-size:16px;
}
.footer{
  margin-top:25px;
  text-align:center;
  font-size:12px;
  color:#777;
}

/* MODAL */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
}
.modal-content{
  background:#fff;
  max-width:600px;
  margin:80px auto;
  padding:20px;
  border-radius:8px;
}
@media print{
  .controls,button,.modal{display:none}
}
</style>
</head>

<body>

<div class="container">

<div class="header">
  <img src="logo.png" class="logo">
  <h1>–ö–ü ¬´–í–æ–¥–æ–ø—Ä–æ–≤—ñ–¥–Ω—ñ –º–µ—Ä–µ–∂—ñ¬ª<br>
</div>

<h2>–ñ—É—Ä–Ω–∞–ª –æ–±–ª—ñ–∫—É –ø–∞–ª–∏–≤–Ω–∏—Ö —Ç–∞–ª–æ–Ω—ñ–≤</h2>

<div class="controls">
  <button class="primary" onclick="openImport()">–Ü–º–ø–æ—Ä—Ç</button>

  <input id="search" placeholder="–ü–æ—à—É–∫ –∑–∞ –Ω–æ–º–µ—Ä–æ–º" oninput="render()">
  <button class="secondary" onclick="clearSearch()">–û—á–∏—Å—Ç–∏—Ç–∏</button>

  <select id="monthFilter" onchange="render()">
    <option value="">–í—Å—ñ –º—ñ—Å—è—Ü—ñ</option>
    <option value="01">–°—ñ—á–µ–Ω—å</option><option value="02">–õ—é—Ç–∏–π</option>
    <option value="03">–ë–µ—Ä–µ–∑–µ–Ω—å</option><option value="04">–ö–≤—ñ—Ç–µ–Ω—å</option>
    <option value="05">–¢—Ä–∞–≤–µ–Ω—å</option><option value="06">–ß–µ—Ä–≤–µ–Ω—å</option>
    <option value="07">–õ–∏–ø–µ–Ω—å</option><option value="08">–°–µ—Ä–ø–µ–Ω—å</option>
    <option value="09">–í–µ—Ä–µ—Å–µ–Ω—å</option><option value="10">–ñ–æ–≤—Ç–µ–Ω—å</option>
    <option value="11">–õ–∏—Å—Ç–æ–ø–∞–¥</option><option value="12">–ì—Ä—É–¥–µ–Ω—å</option>
  </select>

  <button onclick="window.print()">–î—Ä—É–∫</button>
</div>

<table>
<thead>
<tr>
  <th>–ú—ñ—Å—è—Ü—å</th>
  <th>–ù–æ–º–µ—Ä</th>
  <th>–ü–∞–ª–∏–≤–æ</th>
  <th>–ù–æ–º—ñ–Ω–∞–ª</th>
  <th>–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ</th>
  <th>–î—ñ—è</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<div class="summary" id="summary"></div>

<h2>–ü—ñ–¥—Å—É–º–æ–∫ –ø–æ –º—ñ—Å—è—Ü—è—Ö</h2>

<table>
<thead>
<tr>
  <th>–ú—ñ—Å—è—Ü—å</th>
  <th>–ê-95</th>
  <th>–î–ü</th>
  <th>–†–∞–∑–æ–º</th>
</tr>
</thead>
<tbody id="monthSummary"></tbody>
</table>

<div class="footer">
  –°–ª—É–∂–±–æ–≤–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ ‚Ä¢ –í–µ—Ä—Å—ñ—è V 1.5.0
</div>

</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h2>–Ü–º–ø–æ—Ä—Ç —Ç–∞–ª–æ–Ω—ñ–≤</h2>
    <textarea id="importArea" rows="8" style="width:100%"
      placeholder="–í—Å—Ç–∞–≤ —Å—é–¥–∏ —Å–ø–∏—Å–æ–∫ –Ω–æ–º–µ—Ä—ñ–≤ (–∫–æ–∂–µ–Ω –∑ –Ω–æ–≤–æ–≥–æ —Ä—è–¥–∫–∞)"></textarea><br><br>
    <button class="primary" onclick="importTalons()">–î–æ–¥–∞—Ç–∏</button>
    <button onclick="closeImport()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
  </div>
</div>

<script>
let talons=JSON.parse(localStorage.getItem("talons")||"[]");
const months={"01":"–°—ñ—á–µ–Ω—å","02":"–õ—é—Ç–∏–π","03":"–ë–µ—Ä–µ–∑–µ–Ω—å","04":"–ö–≤—ñ—Ç–µ–Ω—å","05":"–¢—Ä–∞–≤–µ–Ω—å","06":"–ß–µ—Ä–≤–µ–Ω—å","07":"–õ–∏–ø–µ–Ω—å","08":"–°–µ—Ä–ø–µ–Ω—å","09":"–í–µ—Ä–µ—Å–µ–Ω—å","10":"–ñ–æ–≤—Ç–µ–Ω—å","11":"–õ–∏—Å—Ç–æ–ø–∞–¥","12":"–ì—Ä—É–¥–µ–Ω—å"};

function normalize(v){return v.replace(/[^\d]/g,"")}

function openImport(){document.getElementById("modal").style.display="block"}
function closeImport(){document.getElementById("modal").style.display="none"}

function importTalons(){
  let lines=document.getElementById("importArea").value.split(/\r?\n/);
  let added=0;
  lines.forEach(l=>{
    let c=normalize(l);
    if(!/^\d{9}$/.test(c))return;
    if(talons.find(t=>t.code===c))return;
    talons.push({code:c,month:c.substr(0,2),fuel:c.substr(2,2),nominal:+c.substr(4,2),used:false});
    added++;
  });
  save();render();
  document.getElementById("importArea").value="";
  closeImport();
  alert("–î–æ–¥–∞–Ω–æ —Ç–∞–ª–æ–Ω—ñ–≤: "+added);
}

function toggleUsed(i){talons[i].used=!talons[i].used;save();render()}
function del(i){if(confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Ç–∞–ª–æ–Ω?")){talons.splice(i,1);save();render()}}
function save(){localStorage.setItem("talons",JSON.stringify(talons))}
function clearSearch(){document.getElementById("search").value="";render()}

function render(){
  let tb=document.getElementById("tbody"),ms=document.getElementById("monthSummary");
  tb.innerHTML="";ms.innerHTML="";
  let s=normalize(document.getElementById("search").value),f=document.getElementById("monthFilter").value;
  let a95=0,dp=0,pm={};

  talons.forEach((t,i)=>{
    if(s&&!t.code.includes(s))return;
    if(f&&t.month!==f)return;
    if(t.used){
      t.fuel==="01"?a95+=t.nominal:dp+=t.nominal;
      pm[t.month]=pm[t.month]||{a:0,d:0};
      t.fuel==="01"?pm[t.month].a+=t.nominal:pm[t.month].d+=t.nominal;
    }
    tb.innerHTML+=`
    <tr class="${t.used?"used":""}">
      <td>${months[t.month]}</td>
      <td>‚Ññ${t.code}</td>
      <td>${t.fuel==="01"?"–ë–µ–Ω–∑–∏–Ω –ê-95":"–î–∏–∑–µ–ª—å"}</td>
      <td>${t.nominal}</td>
      <td><input type="checkbox"${t.used?" checked":""} onclick="toggleUsed(${i})"></td>
      <td><button class="danger" onclick="del(${i})">üóë</button></td>
    </tr>`;
  });

  document.getElementById("summary").innerHTML=
    `<div><b>–ê-95:</b> ${a95} –ª</div><div><b>–î–ü:</b> ${dp} –ª</div><div><b>–í—Å—å–æ–≥–æ:</b> ${a95+dp} –ª</div>`;

  Object.keys(pm).sort().forEach(m=>{
    ms.innerHTML+=`<tr><td>${months[m]}</td><td>${pm[m].a}</td><td>${pm[m].d}</td><td><b>${pm[m].a+pm[m].d}</b></td></tr>`;
  });
}
render();
</script>

</body>
</html>

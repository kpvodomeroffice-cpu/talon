<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>–ñ—É—Ä–Ω–∞–ª –ø–∞–ª–∏–≤–Ω–∏—Ö —Ç–∞–ª–æ–Ω—ñ–≤</title>

<style>
/* ===== BASE ===== */
body{
  font-family:system-ui,Arial,sans-serif;
  background:#f4f6f8;
  margin:0;
  padding:20px;
}
.container{
  max-width:1200px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:10px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}
.header{
  text-align:center;
  padding-bottom:14px;
  border-bottom:1px solid #e0e0e0;
  margin-bottom:20px;
}
.logo{max-width:90px;margin-bottom:8px}
h1{
  font-size:26px;   /* ‚Üê –ó–ë–Ü–õ–¨–®–ï–ù–û */
  margin:0;
  font-weight:700;
}
h2{color:#2f6fad;margin:10px 0}

/* ===== CONTROLS ===== */
.controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:10px;
}
input,select,textarea{
  padding:10px;
  font-size:15px;
}
button{
  padding:10px 14px;
  cursor:pointer;
  border:none;
}
button.primary{background:#2f6fad;color:#fff}
button.secondary{background:#9aa5b1;color:#fff}
button.danger{background:#e74c3c;color:#fff}

/* ===== TABLE ===== */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
  font-size:14px;
}
th,td{
  border:1px solid #ddd;
  padding:8px;
  text-align:center;
}
th{background:#f0f3f7}
.used{background:#e9f7ef}

/* ===== SUMMARY ===== */
.summary{
  margin-top:20px;
  font-size:16px;
  font-weight:600;
}

/* ===== FOOTER ===== */
.footer{
  margin-top:25px;
  text-align:center;
  font-size:12px;
  color:#777;
}

/* ===== MODAL ===== */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
}
.modal-content{
  background:#fff;
  max-width:600px;
  margin:80px auto;
  padding:20px;
  border-radius:8px;
}

/* ===== PRINT ===== */
@media print{
  body{background:#fff;padding:0}
  .container{box-shadow:none;border-radius:0}

  .screen-only,
  #toTop{
    display:none!important;
  }

  .print-summary{
    display:block!important;
  }

  .print-table{
    width:100%;
    border-collapse:collapse;
    font-size:13px;
    margin-top:20px;
  }

  .print-table th{
    background:#d9d9d9;
    font-weight:600;
  }

  .print-table th,
  .print-table td{
    border:1px solid #000;
    padding:8px;
  }

  .print-table td:first-child{width:70%}
  .print-table td:last-child{text-align:center}
}

/* ===== TO TOP ===== */
#toTop{
  position:fixed;
  right:20px;
  bottom:20px;
  width:44px;
  height:44px;
  border-radius:50%;
  background:#2f6fad;
  color:#fff;
  font-size:18px;
  display:none;
  z-index:1000;
}
#toTop:hover{background:#1f4f7a}
</style>
</head>

<body>

<div class="container">

<div class="header">
  <img src="logo.png" class="logo">
  <h1>–ö–ü ¬´–í–æ–¥–æ–ø—Ä–æ–≤—ñ–¥–Ω—ñ –º–µ—Ä–µ–∂—ñ¬ª</h1>
</div>

<h2 class="screen-only">–ñ—É—Ä–Ω–∞–ª –æ–±–ª—ñ–∫—É –ø–∞–ª–∏–≤–Ω–∏—Ö —Ç–∞–ª–æ–Ω—ñ–≤</h2>

<div class="controls screen-only">
  <button class="primary" onclick="openImport()">–Ü–º–ø–æ—Ä—Ç —Ç–∞–ª–æ–Ω—ñ–≤</button>

  <input id="search" placeholder="–ü–æ—à—É–∫ –∑–∞ –Ω–æ–º–µ—Ä–æ–º" oninput="render()">
  <button class="secondary" onclick="clearSearch()">–û—á–∏—Å—Ç–∏—Ç–∏</button>

  <select id="monthFilter" onchange="render()">
    <option value="">–í—Å—ñ –º—ñ—Å—è—Ü—ñ</option>
    <option value="01">–°—ñ—á–µ–Ω—å</option><option value="02">–õ—é—Ç–∏–π</option>
    <option value="03">–ë–µ—Ä–µ–∑–µ–Ω—å</option><option value="04">–ö–≤—ñ—Ç–µ–Ω—å</option>
    <option value="05">–¢—Ä–∞–≤–µ–Ω—å</option><option value="06">–ß–µ—Ä–≤–µ–Ω—å</option>
    <option value="07">–õ–∏–ø–µ–Ω—å</option><option value="08">–°–µ—Ä–ø–µ–Ω—å</option>
    <option value="09">–í–µ—Ä–µ—Å–µ–Ω—å</option><option value="10">–ñ–æ–≤—Ç–µ–Ω—å</option>
    <option value="11">–õ–∏—Å—Ç–æ–ø–∞–¥</option><option value="12">–ì—Ä—É–¥–µ–Ω—å</option>
  </select>

  <select id="printMode">
    <option value="month">–î—Ä—É–∫ –∑–∞ –º—ñ—Å—è—Ü—å</option>
    <option value="all">–î—Ä—É–∫ –∑–∞ –≤–µ—Å—å –ø–µ—Ä—ñ–æ–¥</option>
  </select>

  <!-- ‚Üê –ö–ù–û–ü–ö–ê –î–†–£–ö –ü–ï–†–ï–ù–ï–°–ï–ù–ê –°–Æ–î–ò -->
  <button onclick="preparePrint()">–î—Ä—É–∫</button>

  <button onclick="exportState()">–ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö</button>
  <button onclick="openStateImport()">–Ü–º–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö</button>
</div>

<table class="screen-only">
<thead>
<tr>
  <th>–ú—ñ—Å—è—Ü—å</th>
  <th>–ù–æ–º–µ—Ä</th>
  <th>–ü–∞–ª–∏–≤–æ</th>
  <th>–ù–æ–º—ñ–Ω–∞–ª</th>
  <th>–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ</th>
  <th>–î—ñ—è</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<div class="summary screen-only" id="summary"></div>

<!-- ===== PRINT SUMMARY ===== -->
<div class="print-summary" style="display:none">
  <h2 id="printTitle"></h2>
  <table class="print-table">
    <thead>
      <tr>
        <th>–ü–æ–∫–∞–∑–Ω–∏–∫</th>
        <th>–ó–Ω–∞—á–µ–Ω–Ω—è</th>
      </tr>
    </thead>
    <tbody id="printBody"></tbody>
  </table>
</div>

<div class="footer screen-only">
  –°–ª—É–∂–±–æ–≤–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ ‚Ä¢ –í–µ—Ä—Å—ñ—è V 2.1.1
</div>

</div>


<!-- ===== IMPORT TALONS MODAL ===== -->
<div class="modal" id="modalTalons">
  <div class="modal-content">
    <h2>–Ü–º–ø–æ—Ä—Ç —Ç–∞–ª–æ–Ω—ñ–≤</h2>
    <textarea id="importArea" rows="8" style="width:100%"
      placeholder="–ö–æ–∂–µ–Ω –Ω–æ–º–µ—Ä –∑ –Ω–æ–≤–æ–≥–æ —Ä—è–¥–∫–∞"></textarea><br><br>
    <button class="primary" onclick="importTalons()">–î–æ–¥–∞—Ç–∏</button>
    <button onclick="closeImport()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
  </div>
</div>

<!-- ===== IMPORT STATE MODAL ===== -->
<div class="modal" id="modalState">
  <div class="modal-content">
    <h2>–Ü–º–ø–æ—Ä—Ç —Å—Ç–∞–Ω—É (JSON)</h2>
    <input type="file" id="stateFile" accept=".json"><br><br>
    <button class="primary" onclick="importState()">–Ü–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏</button>
    <button onclick="closeStateImport()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
  </div>
</div>

<button id="toTop" onclick="scrollToTop()">‚¨Ü</button>

<script>
const months={
  "01":"–°—ñ—á–µ–Ω—å","02":"–õ—é—Ç–∏–π","03":"–ë–µ—Ä–µ–∑–µ–Ω—å","04":"–ö–≤—ñ—Ç–µ–Ω—å",
  "05":"–¢—Ä–∞–≤–µ–Ω—å","06":"–ß–µ—Ä–≤–µ–Ω—å","07":"–õ–∏–ø–µ–Ω—å","08":"–°–µ—Ä–ø–µ–Ω—å",
  "09":"–í–µ—Ä–µ—Å–µ–Ω—å","10":"–ñ–æ–≤—Ç–µ–Ω—å","11":"–õ–∏—Å—Ç–æ–ø–∞–¥","12":"–ì—Ä—É–¥–µ–Ω—å"
};

let talons = JSON.parse(localStorage.getItem("talons") || "[]");

function normalize(v){ return v.replace(/[^\d]/g,""); }

/* ===== IMPORT TALONS ===== */
function openImport(){ modalTalons.style.display="block"; }
function closeImport(){ modalTalons.style.display="none"; }

function importTalons(){
  const lines = importArea.value.split(/\r?\n/);
  let added = 0;

  lines.forEach(l=>{
    const c = normalize(l);
    if(!/^\d{9}$/.test(c)) return;
    if(talons.find(t=>t.code===c)) return;

    talons.push({
      code:c,
      month:c.substr(0,2),
      fuel:c.substr(2,2),
      nominal:+c.substr(4,2),
      used:false
    });
    added++;
  });

  save(); render();
  importArea.value="";
  closeImport();
  alert("–î–æ–¥–∞–Ω–æ —Ç–∞–ª–æ–Ω—ñ–≤: " + added);
}

/* ===== EXPORT / IMPORT STATE ===== */
function exportState(){
  const data = JSON.stringify(talons, null, 2);
  const blob = new Blob([data], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "talons-backup.json";
  a.click();
}

function openStateImport(){ modalState.style.display="block"; }
function closeStateImport(){ modalState.style.display="none"; }

function importState(){
  const f = stateFile.files[0];
  if(!f) return;

  const r = new FileReader();
  r.onload = e => {
    try{
      talons = JSON.parse(e.target.result);
      save(); render();
      closeStateImport();
      alert("–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ");
    }catch{
      alert("–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–∞–π–ª");
    }
  };
  r.readAsText(f);
}

/* ===== JOURNAL ===== */
function toggleUsed(i){
  talons[i].used = !talons[i].used;
  save(); render();
}
function del(i){
  if(confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Ç–∞–ª–æ–Ω?")){
    talons.splice(i,1);
    save(); render();
  }
}
function save(){ localStorage.setItem("talons", JSON.stringify(talons)); }
function clearSearch(){ search.value=""; render(); }

function render(){
  tbody.innerHTML="";
  const s = normalize(search.value);
  const f = monthFilter.value;
  let a95=0, dp=0;

  talons.forEach((t,i)=>{
    if(s && !t.code.includes(s)) return;
    if(f && t.month!==f) return;

    if(t.used){
      t.fuel==="01" ? a95+=t.nominal : dp+=t.nominal;
    }

    tbody.innerHTML += `
    <tr class="${t.used?"used":""}">
      <td>${months[t.month]}</td>
      <td>‚Ññ${t.code}</td>
      <td>${t.fuel==="01"?"–ë–µ–Ω–∑–∏–Ω –ê-95":"–î–∏–∑–µ–ª—å"}</td>
      <td>${t.nominal}</td>
      <td><input type="checkbox"${t.used?" checked":""}
        onclick="toggleUsed(${i})"></td>
      <td><button class="danger" onclick="del(${i})">üóë</button></td>
    </tr>`;
  });

  summary.innerText =
    `A-95: ${a95} –ª   |   –î–ü: ${dp} –ª   |   –í—Å—å–æ–≥–æ: ${a95+dp} –ª`;
}

/* ===== PRINT ===== */
function preparePrint(){
  const mode = printMode.value;
  const m = monthFilter.value;
  let a95=0, dp=0;

  talons.forEach(t=>{
    if(!t.used) return;
    if(mode==="month" && t.month!==m) return;
    t.fuel==="01" ? a95+=t.nominal : dp+=t.nominal;
  });

  if(mode==="month"){
    if(!m){ alert("–û–±–µ—Ä—ñ—Ç—å –º—ñ—Å—è—Ü—å"); return; }
    printTitle.innerText =
      "–ü—ñ–¥—Å—É–º–æ–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–ª—å–Ω–æ–≥–æ –∑–∞ " + months[m];
  }else{
    printTitle.innerText =
      "–ü—ñ–¥—Å—É–º–æ–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–ª—å–Ω–æ–≥–æ –∑–∞ –≤–µ—Å—å –ø–µ—Ä—ñ–æ–¥";
  }

  printBody.innerHTML = `
    <tr><td>–ë–µ–Ω–∑–∏–Ω –ê-95, –ª</td><td>${a95}</td></tr>
    <tr><td>–î–∏–∑–µ–ª—å–Ω–µ –ø–∞–ª–∏–≤–æ, –ª</td><td>${dp}</td></tr>
    <tr><td><b>–í—Å—å–æ–≥–æ, –ª</b></td><td><b>${a95+dp}</b></td></tr>
  `;

  window.print();
}

/* ===== TO TOP ===== */
function scrollToTop(){
  window.scrollTo({top:0, behavior:"smooth"});
}
window.addEventListener("scroll",()=>{
  toTop.style.display = window.scrollY > 300 ? "block" : "none";
});

render();
</script>

</body>
</html>

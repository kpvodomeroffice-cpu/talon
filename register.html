<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>–ñ—É—Ä–Ω–∞–ª –ø–∞–ª–∏–≤–Ω–∏—Ö —Ç–∞–ª–æ–Ω—ñ–≤</title>

<style>
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 20px;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.header {
  text-align: center;
  padding-bottom: 12px;
  border-bottom: 1px solid #e0e0e0;
  margin-bottom: 20px;
}

.logo {
  max-width: 100px;
  margin-bottom: 8px;
}

h1 {
  font-size: 20px;
  margin: 0;
}

h2 {
  margin-top: 25px;
  color: #2f6fad;
}

.controls {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 10px;
}

input, select {
  padding: 10px;
  font-size: 16px;
}

button {
  padding: 10px 14px;
  font-size: 14px;
  cursor: pointer;
}

button.danger {
  background: #e74c3c;
  color: white;
  border: none;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
  font-size: 14px;
}

th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: center;
}

th {
  background: #f0f3f7;
}

.used {
  background: #e9f7ef;
}

.summary {
  margin-top: 20px;
  font-size: 16px;
  display: flex;
  gap: 30px;
  flex-wrap: wrap;
}

.footer {
  margin-top: 25px;
  text-align: center;
  font-size: 12px;
  color: #777;
}

@media print {
  .controls, button {
    display: none;
  }
}
</style>
</head>

<body>

<div class="container">

  <!-- –®–ê–ü–ö–ê -->
  <div class="header">
    <img src="logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø –ö–ü" class="logo">
    <h1>–ö–ü ¬´–í–æ–¥–æ–ø—Ä–æ–≤—ñ–¥–Ω—ñ –º–µ—Ä–µ–∂—ñ¬ª<br>
  </div>

  <h2>–ñ—É—Ä–Ω–∞–ª –æ–±–ª—ñ–∫—É –ø–∞–ª–∏–≤–Ω–∏—Ö —Ç–∞–ª–æ–Ω—ñ–≤</h2>

  <!-- –ö–ï–†–£–í–ê–ù–ù–Ø -->
  <div class="controls">
    <input id="newCode" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–æ–º–µ—Ä —Ç–∞–ª–æ–Ω–∞ (–º–æ–∂–Ω–∞ –∑ ‚Ññ)">
    <button onclick="addTalon()">–î–æ–¥–∞—Ç–∏</button>

    <input id="search" placeholder="–ü–æ—à—É–∫ –∑–∞ –Ω–æ–º–µ—Ä–æ–º" oninput="render()">

    <select id="monthFilter" onchange="render()">
      <option value="">–í—Å—ñ –º—ñ—Å—è—Ü—ñ</option>
      <option value="01">–°—ñ—á–µ–Ω—å</option><option value="02">–õ—é—Ç–∏–π</option>
      <option value="03">–ë–µ—Ä–µ–∑–µ–Ω—å</option><option value="04">–ö–≤—ñ—Ç–µ–Ω—å</option>
      <option value="05">–¢—Ä–∞–≤–µ–Ω—å</option><option value="06">–ß–µ—Ä–≤–µ–Ω—å</option>
      <option value="07">–õ–∏–ø–µ–Ω—å</option><option value="08">–°–µ—Ä–ø–µ–Ω—å</option>
      <option value="09">–í–µ—Ä–µ—Å–µ–Ω—å</option><option value="10">–ñ–æ–≤—Ç–µ–Ω—å</option>
      <option value="11">–õ–∏—Å—Ç–æ–ø–∞–¥</option><option value="12">–ì—Ä—É–¥–µ–Ω—å</option>
    </select>

    <button onclick="window.print()">–î—Ä—É–∫</button>
  </div>

  <!-- –¢–ê–ë–õ–ò–¶–Ø -->
  <table>
    <thead>
      <tr>
        <th>–ú—ñ—Å—è—Ü—å</th>
        <th>–ù–æ–º–µ—Ä —Ç–∞–ª–æ–Ω–∞</th>
        <th>–ü–∞–ª–∏–≤–æ</th>
        <th>–ù–æ–º—ñ–Ω–∞–ª (–ª)</th>
        <th>–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ</th>
        <th>–î—ñ—è</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <!-- –ü–Ü–î–°–£–ú–ö–ò -->
  <div class="summary" id="summary"></div>

  <h2>–ü—ñ–¥—Å—É–º–æ–∫ –ø–æ –º—ñ—Å—è—Ü—è—Ö</h2>

  <table>
    <thead>
      <tr>
        <th>–ú—ñ—Å—è—Ü—å</th>
        <th>–ê-95 (–ª)</th>
        <th>–î–ü (–ª)</th>
        <th>–†–∞–∑–æ–º (–ª)</th>
      </tr>
    </thead>
    <tbody id="monthSummary"></tbody>
  </table>

  <div class="footer">
    –°–ª—É–∂–±–æ–≤–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ ‚Ä¢ –í–µ—Ä—Å—ñ—è V 1.4.0
  </div>

</div>

<script>
let talons = JSON.parse(localStorage.getItem("talons") || "[]");

const months = {
  "01":"–°—ñ—á–µ–Ω—å","02":"–õ—é—Ç–∏–π","03":"–ë–µ—Ä–µ–∑–µ–Ω—å","04":"–ö–≤—ñ—Ç–µ–Ω—å",
  "05":"–¢—Ä–∞–≤–µ–Ω—å","06":"–ß–µ—Ä–≤–µ–Ω—å","07":"–õ–∏–ø–µ–Ω—å","08":"–°–µ—Ä–ø–µ–Ω—å",
  "09":"–í–µ—Ä–µ—Å–µ–Ω—å","10":"–ñ–æ–≤—Ç–µ–Ω—å","11":"–õ–∏—Å—Ç–æ–ø–∞–¥","12":"–ì—Ä—É–¥–µ–Ω—å"
};

function normalizeCode(input) {
  return input.replace(/[^\d]/g, "");
}

function addTalon() {
  let raw = document.getElementById("newCode").value;
  let c = normalizeCode(raw);

  if (!/^\d{9}$/.test(c)) {
    alert("–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞ —Ç–∞–ª–æ–Ω–∞");
    return;
  }

  if (talons.find(t => t.code === c)) {
    alert("–¢–∞–∫–∏–π —Ç–∞–ª–æ–Ω –≤–∂–µ —ñ—Å–Ω—É—î");
    return;
  }

  talons.push({
    code: c,
    month: c.substr(0,2),
    fuel: c.substr(2,2),
    nominal: parseInt(c.substr(4,2),10),
    used: false
  });

  save();
  render();
  document.getElementById("newCode").value = "";
}

function toggleUsed(i) {
  talons[i].used = !talons[i].used;
  save();
  render();
}

function deleteTalon(i) {
  if (!confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–∞–ª–æ–Ω?")) return;
  talons.splice(i,1);
  save();
  render();
}

function save() {
  localStorage.setItem("talons", JSON.stringify(talons));
}

function render() {
  const tbody = document.getElementById("tbody");
  const monthSummary = document.getElementById("monthSummary");
  const search = normalizeCode(document.getElementById("search").value);
  const filterMonth = document.getElementById("monthFilter").value;

  tbody.innerHTML = "";
  monthSummary.innerHTML = "";

  let sum95 = 0, sumDP = 0;
  const perMonth = {};

  talons.forEach((t, i) => {
    if (search && !t.code.includes(search)) return;
    if (filterMonth && t.month !== filterMonth) return;

    if (t.used) {
      if (t.fuel === "01") sum95 += t.nominal;
      if (t.fuel === "02") sumDP += t.nominal;

      if (!perMonth[t.month]) perMonth[t.month] = {f95:0, dp:0};
      if (t.fuel === "01") perMonth[t.month].f95 += t.nominal;
      if (t.fuel === "02") perMonth[t.month].dp += t.nominal;
    }

    const tr = document.createElement("tr");
    if (t.used) tr.className = "used";

    tr.innerHTML = `
      <td>${months[t.month]}</td>
      <td>‚Ññ${t.code}</td>
      <td>${t.fuel==="01"?"–ë–µ–Ω–∑–∏–Ω –ê-95":"–î–∏–∑–µ–ª—å–Ω–µ –ø–∞–ª–∏–≤–æ"}</td>
      <td>${t.nominal}</td>
      <td><input type="checkbox" ${t.used?"checked":""} onclick="toggleUsed(${i})"></td>
      <td><button class="danger" onclick="deleteTalon(${i})">üóë</button></td>
    `;

    tbody.appendChild(tr);
  });

  document.getElementById("summary").innerHTML = `
    <div><b>–ë–µ–Ω–∑–∏–Ω –ê-95:</b> ${sum95} –ª</div>
    <div><b>–î–∏–∑–µ–ª—å–Ω–µ –ø–∞–ª–∏–≤–æ:</b> ${sumDP} –ª</div>
    <div><b>–í—Å—å–æ–≥–æ:</b> ${sum95 + sumDP} –ª</div>
  `;

  Object.keys(perMonth).sort().forEach(m => {
    const r = perMonth[m];
    monthSummary.innerHTML += `
      <tr>
        <td>${months[m]}</td>
        <td>${r.f95}</td>
        <td>${r.dp}</td>
        <td><b>${r.f95 + r.dp}</b></td>
      </tr>`;
  });
}

render();
</script>

</body>
</html>
